<!DOCTYPE html>
<html>
  <head>
    <title>PE File Checksum Algorithm - Litao.Me</title>
    
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <link rel="stylesheet" media="screen" href="/stylesheets/screen.css" type="text/css" />
    
    
  </head>
  <body>
    <div id="page">
      <div id="header">
        <a href="/"><h1>Litao.Me</h1></a>
      </div>
      <div id="body">
        <h1>PE File Checksum Algorithm</h1>
        <div class="postdate">Posted on 28 Jun 2011</div>
<div class="post">
<p>这两天闲来无事，在看PE文件相关的文章，我们知道PE文件是有校验和算法的，而且像驱动，或者系统DLL之类的特殊执行文件，对校验和的要求是极其高的，如果没算对，就认为是非法文件。微软SDK里提供一个API，叫MapFileAndCheckSum，这个可以计算出一个PE文件的校验和，该API的相关分析，可以参考这篇文章<a href="http://www.codeproject.com/KB/cpp/PEChecksum.aspx">《An Analysis of the Windows PE Checksum Algorithm》</a>。关于校验和算法，还有一个比较有意思的算法是IP协议的校验和算法，可以看<a href="http://datatracker.ietf.org/doc/rfc1071/?include_text=1">RFC 1071</a>。还有WIKI中的这篇文章<a href="http://en.wikipedia.org/wiki/Redundancy_check#Error_detection_schemes">《Error detection and correction》</a>。<br/>
我感觉这个应用层实现的PE CHECK SUM算法太过恶心了..就看了下系统内核PE加载器的内核实现，发现校验和算法部分和应用层的完全不同，比应用层的简洁多了，直接上代码:</p>

<script src="https://gist.github.com/3747774.js"> </script>


</div>
 
<div id="related">
  <h2>Related Posts</h2>
  <ul class="posts">
    
      <li><span>16 Sep 2012</span> - <a href="/2012/09/16/begin.html">新的开始</a></li>
    
      <li><span>25 Apr 2012</span> - <a href="/2012/04/25/open-registry-key-in-regedit-exe.html">Open registry key in regedit.exe</a></li>
    
      <li><span>23 Apr 2012</span> - <a href="/2012/04/23/How-to-Get-Network-Change-automation.html">如何自动获取网络变化通知</a></li>
    
      <li><span>19 Apr 2012</span> - <a href="/2012/04/19/analyze-dead-lock.html">一次死锁的分析</a></li>
    
      <li><span>05 Mar 2012</span> - <a href="/2012/03/05/use_declspec_thread_in_dll.html">Use __declspec(thread) in dll occured Exception</a></li>
    
  </ul>
</div>


<br />
<br />
<hr />
<div id="comments">
  <h2>Comments</h2>
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    var disqus_identifier = "/2011/06/28/PE-File-Checksum-Algorithm.html";
    (function() {
     var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
     dsq.src = 'http://eahydra.disqus.com/embed.js';
     (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript=eahydra">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

      </div>
    </div>
  </body>
</html>
